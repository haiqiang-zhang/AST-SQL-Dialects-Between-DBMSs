pragma recursive_triggers = off;
CREATE TABLE tbl (a INTEGER PRIMARY KEY, b) WITHOUT rowid;
INSERT INTO tbl VALUES(1, 2);
INSERT INTO tbl VALUES(3, 4);
CREATE TABLE rlog (idx, old_a, old_b, db_sum_a, db_sum_b, new_a, new_b);
CREATE TABLE clog (idx, old_a, old_b, db_sum_a, db_sum_b, new_a, new_b);
UPDATE tbl SET a = a * 10, b = b * 10;
SELECT * FROM rlog ORDER BY idx;
SELECT * FROM clog ORDER BY idx;
DELETE FROM rlog;
DELETE FROM tbl;
INSERT INTO tbl VALUES (100, 100);
INSERT INTO tbl VALUES (300, 200);
DELETE FROM tbl;
SELECT * FROM rlog;
DELETE FROM rlog;
CREATE TABLE other_tbl(a, b);
INSERT INTO other_tbl VALUES(1, 2);
INSERT INTO other_tbl VALUES(3, 4);
-- INSERT INTO tbl SELECT * FROM other_tbl;
INSERT INTO tbl VALUES(5, 6);
DROP TABLE other_tbl;
SELECT * FROM rlog;
PRAGMA integrity_check;
DROP TABLE rlog;
DROP TABLE clog;
DROP TABLE tbl;
CREATE TABLE tbl (a, b PRIMARY KEY) WITHOUT rowid;
INSERT INTO tbl VALUES(1, 2);
INSERT INTO tbl VALUES(3, 4);
CREATE TABLE rlog (idx, old_a, old_b, db_sum_a, db_sum_b, new_a, new_b);
CREATE TABLE clog (idx, old_a, old_b, db_sum_a, db_sum_b, new_a, new_b);
UPDATE tbl SET a = a * 10, b = b * 10;
SELECT * FROM rlog ORDER BY idx;
SELECT * FROM clog ORDER BY idx;
DELETE FROM rlog;
DELETE FROM tbl;
INSERT INTO tbl VALUES (100, 100);
INSERT INTO tbl VALUES (300, 200);
DELETE FROM tbl;
SELECT * FROM rlog;
DELETE FROM rlog;
CREATE TABLE other_tbl(a, b);
INSERT INTO other_tbl VALUES(1, 2);
INSERT INTO other_tbl VALUES(3, 4);
-- INSERT INTO tbl SELECT * FROM other_tbl;
INSERT INTO tbl VALUES(5, 6);
DROP TABLE other_tbl;
SELECT * FROM rlog;
PRAGMA integrity_check;
DROP TABLE rlog;
DROP TABLE clog;
DROP TABLE tbl;
CREATE TABLE tbl (a PRIMARY KEY, b) WITHOUT rowid;
CREATE INDEX tbl_idx ON tbl(b);
INSERT INTO tbl VALUES(1, 2);
INSERT INTO tbl VALUES(3, 4);
CREATE TABLE rlog (idx, old_a, old_b, db_sum_a, db_sum_b, new_a, new_b);
CREATE TABLE clog (idx, old_a, old_b, db_sum_a, db_sum_b, new_a, new_b);
UPDATE tbl SET a = a * 10, b = b * 10;
SELECT * FROM rlog ORDER BY idx;
SELECT * FROM clog ORDER BY idx;
DELETE FROM rlog;
DELETE FROM tbl;
INSERT INTO tbl VALUES (100, 100);
INSERT INTO tbl VALUES (300, 200);
DELETE FROM tbl;
SELECT * FROM rlog;
DELETE FROM rlog;
CREATE TABLE other_tbl(a, b);
INSERT INTO other_tbl VALUES(1, 2);
INSERT INTO other_tbl VALUES(3, 4);
-- INSERT INTO tbl SELECT * FROM other_tbl;
INSERT INTO tbl VALUES(5, 6);
DROP TABLE other_tbl;
SELECT * FROM rlog;
PRAGMA integrity_check;
DROP INDEX tbl_idx;
DROP TABLE rlog;
DROP TABLE clog;
DROP TABLE tbl;
CREATE TEMP TABLE tbl (a PRIMARY KEY, b) WITHOUT rowid;
CREATE INDEX tbl_idx ON tbl(b);
INSERT INTO tbl VALUES(1, 2);
INSERT INTO tbl VALUES(3, 4);
CREATE TABLE rlog (idx, old_a, old_b, db_sum_a, db_sum_b, new_a, new_b);
CREATE TABLE clog (idx, old_a, old_b, db_sum_a, db_sum_b, new_a, new_b);
UPDATE tbl SET a = a * 10, b = b * 10;
SELECT * FROM rlog ORDER BY idx;
SELECT * FROM clog ORDER BY idx;
DELETE FROM rlog;
DELETE FROM tbl;
INSERT INTO tbl VALUES (100, 100);
INSERT INTO tbl VALUES (300, 200);
DELETE FROM tbl;
SELECT * FROM rlog;
DELETE FROM rlog;
CREATE TABLE other_tbl(a, b);
INSERT INTO other_tbl VALUES(1, 2);
INSERT INTO other_tbl VALUES(3, 4);
-- INSERT INTO tbl SELECT * FROM other_tbl;
INSERT INTO tbl VALUES(5, 6);
DROP TABLE other_tbl;
SELECT * FROM rlog;
PRAGMA integrity_check;
DROP INDEX tbl_idx;
DROP TABLE rlog;
DROP TABLE clog;
DROP TABLE tbl;
CREATE TEMP TABLE tbl (a PRIMARY KEY, b) WITHOUT rowid;
INSERT INTO tbl VALUES(1, 2);
INSERT INTO tbl VALUES(3, 4);
CREATE TABLE rlog (idx, old_a, old_b, db_sum_a, db_sum_b, new_a, new_b);
CREATE TABLE clog (idx, old_a, old_b, db_sum_a, db_sum_b, new_a, new_b);
UPDATE tbl SET a = a * 10, b = b * 10;
SELECT * FROM rlog ORDER BY idx;
SELECT * FROM clog ORDER BY idx;
DELETE FROM rlog;
DELETE FROM tbl;
INSERT INTO tbl VALUES (100, 100);
INSERT INTO tbl VALUES (300, 200);
DELETE FROM tbl;
SELECT * FROM rlog;
DELETE FROM rlog;
CREATE TABLE other_tbl(a, b);
INSERT INTO other_tbl VALUES(1, 2);
INSERT INTO other_tbl VALUES(3, 4);
-- INSERT INTO tbl SELECT * FROM other_tbl;
INSERT INTO tbl VALUES(5, 6);
DROP TABLE other_tbl;
SELECT * FROM rlog;
PRAGMA integrity_check;
DROP TABLE rlog;
DROP TABLE clog;
DROP TABLE tbl;
CREATE TEMPORARY TABLE tbl (a INTEGER PRIMARY KEY, b) WITHOUT rowid;
INSERT INTO tbl VALUES(1, 2);
INSERT INTO tbl VALUES(3, 4);
CREATE TABLE rlog (idx, old_a, old_b, db_sum_a, db_sum_b, new_a, new_b);
CREATE TABLE clog (idx, old_a, old_b, db_sum_a, db_sum_b, new_a, new_b);
UPDATE tbl SET a = a * 10, b = b * 10;
SELECT * FROM rlog ORDER BY idx;
SELECT * FROM clog ORDER BY idx;
DELETE FROM rlog;
DELETE FROM tbl;
INSERT INTO tbl VALUES (100, 100);
INSERT INTO tbl VALUES (300, 200);
DELETE FROM tbl;
SELECT * FROM rlog;
DELETE FROM rlog;
CREATE TABLE other_tbl(a, b);
INSERT INTO other_tbl VALUES(1, 2);
INSERT INTO other_tbl VALUES(3, 4);
-- INSERT INTO tbl SELECT * FROM other_tbl;
INSERT INTO tbl VALUES(5, 6);
DROP TABLE other_tbl;
SELECT * FROM rlog;
PRAGMA integrity_check;
DROP TABLE rlog;
DROP TABLE clog;
DROP TABLE tbl;
CREATE TABLE tbl(a PRIMARY KEY, b, c) WITHOUT rowid;
CREATE TABLE log(a, b, c);
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
UPDATE tbl SET b = 2;
UPDATE tbl SET c = 10 WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
UPDATE tbl SET c = 10 WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
UPDATE tbl SET c = 10 WHERE a = 1;
UPDATE tbl SET b = 2;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
UPDATE tbl SET c = 10 WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
PRAGMA integrity_check;
DROP TABLE tbl;
DROP TABLE log;
CREATE TABLE tbl(a PRIMARY KEY, b, c) WITHOUT rowid;
CREATE TABLE log(a, b, c);
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
UPDATE tbl SET b = 2;
DELETE FROM tbl WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM tbl WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM tbl WHERE a = 1;
UPDATE tbl SET b = 2;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM tbl WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
PRAGMA integrity_check;
DROP TABLE tbl;
DROP TABLE log;
CREATE TABLE tbl(a PRIMARY KEY, b, c) WITHOUT rowid;
CREATE TABLE log(a, b, c);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
UPDATE tbl SET b = '';
INSERT INTO tbl VALUES(1, 2, 3);
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO tbl VALUES(1, 2, 3);
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO tbl VALUES(1, 2, 3);
UPDATE tbl SET b = '';
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO tbl VALUES(1, 2, 3);
SELECT * FROM tbl;
SELECT * FROM log;
PRAGMA integrity_check;
DROP TABLE tbl;
DROP TABLE log;
CREATE TABLE tbl(a PRIMARY KEY, b, c) WITHOUT rowid;
CREATE TABLE log(a, b, c);
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO log VALUES(10, 2, 3);
UPDATE tbl SET c = 10 WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
UPDATE tbl SET c = 10 WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
UPDATE tbl SET c = 10 WHERE a = 1;
INSERT INTO log VALUES(10, 2, 3);
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
UPDATE tbl SET c = 10 WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
PRAGMA integrity_check;
DROP TABLE tbl;
DROP TABLE log;
CREATE TABLE tbl(a PRIMARY KEY, b, c) WITHOUT rowid;
CREATE TABLE log(a, b, c);
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO log VALUES('', 2, 3);
DELETE FROM tbl WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM tbl WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM tbl WHERE a = 1;
INSERT INTO log VALUES('', 2, 3);
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM tbl WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
PRAGMA integrity_check;
DROP TABLE tbl;
DROP TABLE log;
CREATE TABLE tbl(a PRIMARY KEY, b, c) WITHOUT rowid;
CREATE TABLE log(a, b, c);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO log VALUES(3, 2, 3);
INSERT INTO tbl VALUES(1, 2, 3);
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO tbl VALUES(1, 2, 3);
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(3, 2, 3);
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO tbl VALUES(1, 2, 3);
SELECT * FROM tbl;
SELECT * FROM log;
PRAGMA integrity_check;
DROP TABLE tbl;
DROP TABLE log;
CREATE TABLE tbl(a PRIMARY KEY, b, c) WITHOUT rowid;
CREATE TABLE log(a, b, c);
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM log WHERE a = 1;
UPDATE tbl SET c = 10 WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
UPDATE tbl SET c = 10 WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
UPDATE tbl SET c = 10 WHERE a = 1;
DELETE FROM log WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
UPDATE tbl SET c = 10 WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
PRAGMA integrity_check;
DROP TABLE tbl;
DROP TABLE log;
CREATE TABLE tbl(a PRIMARY KEY, b, c) WITHOUT rowid;
CREATE TABLE log(a, b, c);
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM log WHERE a = 1;
DELETE FROM tbl WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM tbl WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM tbl WHERE a = 1;
DELETE FROM log WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM tbl WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
PRAGMA integrity_check;
DROP TABLE tbl;
DROP TABLE log;
CREATE TABLE tbl(a PRIMARY KEY, b, c) WITHOUT rowid;
CREATE TABLE log(a, b, c);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM log WHERE a = 1;
INSERT INTO tbl VALUES(1, 2, 3);
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO tbl VALUES(1, 2, 3);
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO tbl VALUES(1, 2, 3);
DELETE FROM log WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO tbl VALUES(1, 2, 3);
SELECT * FROM tbl;
SELECT * FROM log;
PRAGMA integrity_check;
DROP TABLE tbl;
DROP TABLE log;
CREATE TABLE tbl(a PRIMARY KEY, b, c) WITHOUT rowid;
CREATE TABLE log(a, b, c);
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO tbl VALUES(500, 2 * 10, 700);
UPDATE tbl SET c = 3;
DELETE FROM log;
UPDATE tbl SET c = 10 WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM log;
UPDATE tbl SET c = 10 WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
UPDATE tbl SET c = 10 WHERE a = 1;
INSERT INTO tbl VALUES(500, 2 * 10, 700);
UPDATE tbl SET c = 3;
DELETE FROM log;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM log;
UPDATE tbl SET c = 10 WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
PRAGMA integrity_check;
DROP TABLE tbl;
DROP TABLE log;
CREATE TABLE tbl(a PRIMARY KEY, b, c) WITHOUT rowid;
CREATE TABLE log(a, b, c);
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO tbl VALUES(500, '' * 10, 700);
UPDATE tbl SET c = 3;
DELETE FROM log;
DELETE FROM tbl WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM log;
DELETE FROM tbl WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM tbl WHERE a = 1;
INSERT INTO tbl VALUES(500, '' * 10, 700);
UPDATE tbl SET c = 3;
DELETE FROM log;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM log;
DELETE FROM tbl WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
PRAGMA integrity_check;
DROP TABLE tbl;
DROP TABLE log;
CREATE TABLE tbl(a PRIMARY KEY, b, c) WITHOUT rowid;
CREATE TABLE log(a, b, c);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO tbl VALUES(500, 2 * 10, 700);
UPDATE tbl SET c = '';
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
UPDATE tbl SET c = '';
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO tbl VALUES(500, 2 * 10, 700);
UPDATE tbl SET c = '';
DELETE FROM log;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
UPDATE tbl SET c = '';
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
SELECT * FROM tbl;
SELECT * FROM log;
PRAGMA integrity_check;
DROP TABLE tbl;
DROP TABLE log;
CREATE TABLE tbl(a PRIMARY KEY, b, c) WITHOUT rowid;
CREATE TABLE log(a, b, c);
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO log select * from tbl;
UPDATE tbl SET c = 10 WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
UPDATE tbl SET c = 10 WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
UPDATE tbl SET c = 10 WHERE a = 1;
INSERT INTO log select * from tbl;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
UPDATE tbl SET c = 10 WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
PRAGMA integrity_check;
DROP TABLE tbl;
DROP TABLE log;
CREATE TABLE tbl(a PRIMARY KEY, b, c) WITHOUT rowid;
CREATE TABLE log(a, b, c);
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO log select * from tbl;
DELETE FROM tbl WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM tbl WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM tbl WHERE a = 1;
INSERT INTO log select * from tbl;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
DELETE FROM tbl WHERE a = 1;
SELECT * FROM tbl;
SELECT * FROM log;
PRAGMA integrity_check;
DROP TABLE tbl;
DROP TABLE log;
CREATE TABLE tbl(a PRIMARY KEY, b, c) WITHOUT rowid;
CREATE TABLE log(a, b, c);
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO log select * from tbl;
INSERT INTO tbl VALUES(1, 2, 3);
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO tbl VALUES(1, 2, 3);
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO tbl VALUES(1, 2, 3);
INSERT INTO log select * from tbl;
SELECT * FROM tbl;
SELECT * FROM log;
DELETE FROM tbl;
DELETE FROM log;
INSERT INTO log VALUES(1, 2, 3);
INSERT INTO log VALUES(10, 20, 30);
INSERT INTO tbl VALUES(1, 2, 3);
SELECT * FROM tbl;
SELECT * FROM log;
PRAGMA integrity_check;
DROP TABLE tbl;
DROP TABLE log;
CREATE TABLE tbl (a, b, c, d, PRIMARY KEY(a,b,c,d)) WITHOUT rowid;
CREATE TABLE log (a);
INSERT INTO log VALUES (0);
INSERT INTO tbl VALUES (0, 0, 0, 0);
INSERT INTO tbl VALUES (1, 0, 0, 0);
UPDATE tbl SET b = 1, c = 10;
-- 2
    UPDATE tbl SET b = 10;
-- 0
    UPDATE tbl SET d = 4 WHERE a = 0;
--1
    UPDATE tbl SET a = 4, b = 10;
--0
    SELECT * FROM log;
DROP TABLE tbl;
DROP TABLE log;
CREATE TABLE tbl (a, b, c, d);
CREATE TABLE log (a);
INSERT INTO log VALUES (0);
INSERT INTO tbl VALUES(0, 0, 0, 0);
-- 1 (ifcapable subquery)
    SELECT * FROM log;
UPDATE log SET a = 0;
INSERT INTO tbl VALUES(0, 0, 0, 0);
-- 0
    SELECT * FROM log;
UPDATE log SET a = 0;
INSERT INTO tbl VALUES(200, 0, 0, 0);
-- 1
    SELECT * FROM log;
UPDATE log SET a = 0;
DROP TABLE tbl;
DROP TABLE log;
PRAGMA integrity_check;
CREATE TABLE tblA(a, b, PRIMARY KEY(a,b)) WITHOUT rowid;
CREATE TABLE tblB(a, b, PRIMARY KEY(a,b)) WITHOUT rowid;
CREATE TABLE tblC(a, b, PRIMARY KEY(a,b)) WITHOUT rowid;
INSERT INTO tblA values(1, 2);
SELECT * FROM tblA;
SELECT * FROM tblB;
SELECT * FROM tblC;
DROP TABLE tblA;
DROP TABLE tblB;
DROP TABLE tblC;
CREATE TABLE tbl(a, b, c, PRIMARY KEY(c,a,b)) WITHOUT rowid;
INSERT INTO tbl VALUES (1, 2, 3);
select * from tbl;
DROP TABLE tbl;
CREATE TABLE tbl(a, b, c, PRIMARY KEY(c,a,b)) WITHOUT rowid;
INSERT INTO tbl VALUES (2, 2, 3);
UPDATE tbl set b = 10 WHERE a = 1;
DELETE FROM tbl WHERE a = 1;
DELETE FROM tbl;
INSERT INTO tbl VALUES(100, 200, 300);
DROP TABLE tbl;
CREATE TABLE tbl (a PRIMARY KEY, b, c) WITHOUT rowid;
BEGIN;
INSERT INTO tbl values (1, 2, 3);
SELECT * from tbl;
INSERT OR ABORT INTO tbl values (2, 2, 3);
SELECT * from tbl;
SELECT * from tbl;
INSERT OR REPLACE INTO tbl values (2, 2, 3);
SELECT * from tbl;
INSERT OR ROLLBACK INTO tbl values (3, 2, 3);
SELECT * from tbl;
DELETE FROM tbl;
INSERT INTO tbl values (4, 2, 3);
INSERT INTO tbl values (6, 3, 4);
BEGIN;
UPDATE tbl SET a = 1 WHERE a = 4;
SELECT * from tbl;
UPDATE OR ABORT tbl SET a = 4 WHERE a = 1;
SELECT * from tbl;
UPDATE OR FAIL tbl SET a = 4 WHERE a = 1;
SELECT * from tbl;
UPDATE OR REPLACE tbl SET a = 1 WHERE a = 4;
SELECT * from tbl;
INSERT INTO tbl VALUES (2, 3, 4);
SELECT * FROM tbl;
UPDATE OR ROLLBACK tbl SET a = 4 WHERE a = 1;
SELECT * from tbl;
DROP TABLE tbl;
CREATE TABLE ab(a, b, PRIMARY KEY(a,b)) WITHOUT rowid;
CREATE TABLE cd(c, d, PRIMARY KEY(c,d)) WITHOUT rowid;
INSERT INTO ab VALUES (1, 2);
INSERT INTO ab VALUES (0, 0);
INSERT INTO cd VALUES (3, 4);
CREATE TABLE tlog(ii INTEGER PRIMARY KEY, 
      olda, oldb, oldc, oldd, newa, newb, newc, newd);
CREATE VIEW abcd AS SELECT a, b, c, d FROM ab, cd;
SELECT * FROM tlog;
DELETE FROM tlog;
SELECT * FROM tlog;
DELETE FROM tlog;
SELECT * FROM tlog;
CREATE TABLE t1(a,b,c, PRIMARY KEY(a,b,c)) WITHOUT rowid;
INSERT INTO t1 VALUES(1,2,3);
CREATE VIEW v1 AS
      SELECT a+b AS x, b+c AS y, a+c AS z FROM t1;
SELECT * FROM v1;
CREATE TABLE v1log(a,b,c,d,e,f);
SELECT * FROM v1log;
SELECT * FROM v1log;
INSERT INTO t1 VALUES(4,5,6);
DELETE FROM v1log;
SELECT * FROM v1log;
DELETE FROM v1log;
SELECT * FROM v1log;
DELETE FROM v1log;
SELECT * FROM v1log;
CREATE TABLE t3(a TEXT, b TEXT);
CREATE VIEW v3 AS SELECT t3.a FROM t3;
PRAGMA integrity_check;
