--Query--
COPY (FROM test_structs) TO '__TEST_DIR__/test_structs.parquet' (FORMAT PARQUET)
--Result--
[(5,)]
+--------------------+
--Query--
COPY (FROM string_structs) TO '__TEST_DIR__/string_structs.parquet' (FORMAT PARQUET)
--Result--
[(4,)]
+--------------------+
--Query--
COPY (FROM nested_structs) TO '__TEST_DIR__/nested_structs.parquet' (FORMAT PARQUET)
--Result--
[(5,)]
+--------------------+
--Query--
COPY (SELECT {'i': n} as s FROM generate_series(100000) as t(n)) TO '__TEST_DIR__/large.parquet' (FORMAT 'parquet', ROW_GROUP_SIZE 3000)
--Result--
[(100001,)]
+--------------------+
--Query--
EXPLAIN SELECT * FROM test_structs WHERE i.a < 2
--Result--
[('physical_plan', '┌───────────────────────────┐\n│         SEQ_SCAN          │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│        test_structs       │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│             i             │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│ Filters: i.a<2 AND i.a IS │\n│          NOT NULL         │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│           EC: 1           │\n└───────────────────────────┘                             \n')]
+--------------------+
--Query--
SELECT * FROM test_structs WHERE i.a < 2
--Result--
[({'a': 1, 'b': True},)]
+--------------------+
--Query--
EXPLAIN SELECT * FROM test_structs WHERE i.a > 2
--Result--
[('physical_plan', '┌───────────────────────────┐\n│         SEQ_SCAN          │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│        test_structs       │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│             i             │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│ Filters: i.a>2 AND i.a IS │\n│          NOT NULL         │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│           EC: 1           │\n└───────────────────────────┘                             \n')]
+--------------------+
--Query--
SELECT * FROM test_structs WHERE i.a > 2
--Result--
[({'a': 3, 'b': True},)]
+--------------------+
--Query--
EXPLAIN SELECT * FROM test_structs WHERE i.A < 2
--Result--
[('physical_plan', '┌───────────────────────────┐\n│         SEQ_SCAN          │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│        test_structs       │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│             i             │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│ Filters: i.A<2 AND i.A IS │\n│          NOT NULL         │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│           EC: 1           │\n└───────────────────────────┘                             \n')]
+--------------------+
--Query--
SELECT * FROM test_structs WHERE i.A < 2
--Result--
[({'a': 1, 'b': True},)]
+--------------------+
--Query--
EXPLAIN SELECT * FROM test_structs WHERE i.a IS NULL
--Result--
[('physical_plan', "┌───────────────────────────┐\n│           FILTER          │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│ (struct_extract(i, 'a') IS│\n│            NULL)          │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│           EC: 1           │\n└─────────────┬─────────────┘                             \n┌─────────────┴─────────────┐\n│         SEQ_SCAN          │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│        test_structs       │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│             i             │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│           EC: 5           │\n└───────────────────────────┘                             \n")]
+--------------------+
--Query--
SELECT * FROM test_structs WHERE i.a IS NULL
--Result--
[(None,), ({'a': None, 'b': None},)]
+--------------------+
--Query--
EXPLAIN SELECT * FROM test_structs WHERE i.a = 2 OR i.a IS NULL
--Result--
[('physical_plan', "┌───────────────────────────┐\n│           FILTER          │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│((struct_extract(i, 'a') IS│\n│ NULL) OR (struct_extract(i│\n│        , 'a') = 2))       │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│           EC: 1           │\n└─────────────┬─────────────┘                             \n┌─────────────┴─────────────┐\n│         SEQ_SCAN          │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│        test_structs       │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│             i             │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│           EC: 5           │\n└───────────────────────────┘                             \n")]
+--------------------+
--Query--
SELECT * FROM test_structs WHERE i.a = 2 OR i.a IS NULL ORDER BY 1 DESC NULLS FIRST
--Result--
[(None,), ({'a': None, 'b': None},), ({'a': 2, 'b': False},)]
+--------------------+
--Query--
EXPLAIN SELECT * FROM string_structs WHERE s.a = 'foo'
--Result--
[('physical_plan', '┌───────────────────────────┐\n│         SEQ_SCAN          │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│       string_structs      │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│             s             │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│Filters: s.a=foo AND s.a IS│\n│          NOT NULL         │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│           EC: 1           │\n└───────────────────────────┘                             \n')]
+--------------------+
--Query--
SELECT * FROM string_structs WHERE s.a = 'foo'
--Result--
[({'a': 'foo', 'b': 'bar'},), ({'a': 'foo', 'b': None},)]
+--------------------+
--Query--
EXPLAIN SELECT * FROM large_structs WHERE i.a > 150000
--Result--
[('physical_plan', '┌───────────────────────────┐\n│         SEQ_SCAN          │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│       large_structs       │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│             i             │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│Filters: i.a>150000 AND i.a│\n│         IS NOT NULL       │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│         EC: 40000         │\n└───────────────────────────┘                             \n')]
+--------------------+
--Query--
EXPLAIN SELECT MIN(i.a), MAX(i.a), COUNT(*) FROM large_structs WHERE i.a > 150000
--Result--
[('physical_plan', "┌───────────────────────────┐\n│    UNGROUPED_AGGREGATE    │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│          min(#0)          │\n│          max(#1)          │\n│        count_star()       │\n└─────────────┬─────────────┘                             \n┌─────────────┴─────────────┐\n│         PROJECTION        │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│             #0            │\n│             #0            │\n└─────────────┬─────────────┘                             \n┌─────────────┴─────────────┐\n│         PROJECTION        │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│   struct_extract(i, 'a')  │\n└─────────────┬─────────────┘                             \n┌─────────────┴─────────────┐\n│         SEQ_SCAN          │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│       large_structs       │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│             i             │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│Filters: i.a>150000 AND i.a│\n│         IS NOT NULL       │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│         EC: 40000         │\n└───────────────────────────┘                             \n")]
+--------------------+
--Query--
SELECT MIN(i.a), MAX(i.a), COUNT(*) FROM large_structs WHERE i.a > 150000
--Result--
[(150001, 200000, 50000)]
+--------------------+
--Query--
EXPLAIN SELECT * FROM nested_structs WHERE s.a.b < 2
--Result--
[('physical_plan', '┌───────────────────────────┐\n│         SEQ_SCAN          │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│       nested_structs      │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│             s             │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│ Filters: s.a.b<2 AND s.a.b│\n│         IS NOT NULL       │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│           EC: 1           │\n└───────────────────────────┘                             \n')]
+--------------------+
--Query--
SELECT * FROM nested_structs WHERE s.a.b < 2
--Result--
[({'a': {'b': 1, 'c': False}, 'd': {'e': 2, 'f': 'foo'}},)]
+--------------------+
--Query--
EXPLAIN SELECT * FROM nested_structs WHERE s.a.c = true AND s.d.e = 5
--Result--
[('physical_plan', '┌───────────────────────────┐\n│         SEQ_SCAN          │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│       nested_structs      │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│             s             │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│Filters: s.a.c=true AND s.a│\n│ .c IS NOT NULL AND s.d.e=5│\n│    AND s.d.e IS NOT NULL  │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│           EC: 1           │\n└───────────────────────────┘                             \n')]
+--------------------+
--Query--
SELECT * FROM nested_structs WHERE s.a.c = true AND s.d.e = 5
--Result--
[({'a': {'b': None, 'c': True}, 'd': {'e': 5, 'f': 'qux'}},)]
+--------------------+
--Query--
EXPLAIN SELECT * FROM nested_structs WHERE s.d.f = 'bar'
--Result--
[('physical_plan', '┌───────────────────────────┐\n│         SEQ_SCAN          │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│       nested_structs      │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│             s             │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│ Filters: s.d.f=bar AND s.d│\n│       .f IS NOT NULL      │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│           EC: 1           │\n└───────────────────────────┘                             \n')]
+--------------------+
--Query--
SELECT * FROM nested_structs WHERE s.d.f = 'bar'
--Result--
[({'a': {'b': 3, 'c': True}, 'd': {'e': 4, 'f': 'bar'}},)]
+--------------------+
--Query--
EXPLAIN SELECT * FROM read_parquet('__TEST_DIR__/test_structs.parquet') WHERE i.a < 2
--Result--
[('physical_plan', '┌───────────────────────────┐\n│       READ_PARQUET        │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│             i             │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│ Filters: i.a<2 AND i.a IS │\n│          NOT NULL         │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│           EC: 1           │\n└───────────────────────────┘                             \n')]
+--------------------+
--Query--
SELECT * FROM read_parquet('__TEST_DIR__/test_structs.parquet') WHERE i.a < 2
--Result--
[({'a': 1, 'b': True},)]
+--------------------+
--Query--
EXPLAIN SELECT * FROM read_parquet('__TEST_DIR__/test_structs.parquet') WHERE i.b = true or i.a IS NULL
--Result--
[('physical_plan', "┌───────────────────────────┐\n│           FILTER          │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│((struct_extract(i, 'a') IS│\n│ NULL) OR (struct_extract(i│\n│      , 'b') = true))      │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│           EC: 1           │\n└─────────────┬─────────────┘                             \n┌─────────────┴─────────────┐\n│       READ_PARQUET        │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│             i             │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│           EC: 5           │\n└───────────────────────────┘                             \n")]
+--------------------+
--Query--
SELECT * FROM read_parquet('__TEST_DIR__/test_structs.parquet') WHERE i.b = true or i.a IS NULL ORDER BY ALL
--Result--
[({'a': 1, 'b': True},), ({'a': 3, 'b': True},), ({'a': None, 'b': None},), (None,)]
+--------------------+
--Query--
EXPLAIN SELECT * FROM read_parquet('__TEST_DIR__/string_structs.parquet') WHERE s.a = 'foo'
--Result--
[('physical_plan', '┌───────────────────────────┐\n│       READ_PARQUET        │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│             s             │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│Filters: s.a=foo AND s.a IS│\n│          NOT NULL         │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│           EC: 1           │\n└───────────────────────────┘                             \n')]
+--------------------+
--Query--
SELECT * FROM read_parquet('__TEST_DIR__/string_structs.parquet') WHERE s.a = 'foo'
--Result--
[({'a': 'foo', 'b': 'bar'},), ({'a': 'foo', 'b': None},)]
+--------------------+
--Query--
EXPLAIN SELECT * FROM read_parquet('__TEST_DIR__/nested_structs.parquet') WHERE s.a.b < 2
--Result--
[('physical_plan', '┌───────────────────────────┐\n│       READ_PARQUET        │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│             s             │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│ Filters: s.a.b<2 AND s.a.b│\n│         IS NOT NULL       │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│           EC: 1           │\n└───────────────────────────┘                             \n')]
+--------------------+
--Query--
SELECT * FROM read_parquet('__TEST_DIR__/nested_structs.parquet') WHERE s.a.b < 2
--Result--
[({'a': {'b': 1, 'c': False}, 'd': {'e': 2, 'f': 'foo'}},)]
+--------------------+
--Query--
EXPLAIN SELECT * FROM read_parquet('__TEST_DIR__/nested_structs.parquet') WHERE s.a.c = true AND s.d.e = 5
--Result--
[('physical_plan', '┌───────────────────────────┐\n│       READ_PARQUET        │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│             s             │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│Filters: s.a.c=true AND s.a│\n│ .c IS NOT NULL AND s.d.e=5│\n│    AND s.d.e IS NOT NULL  │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│           EC: 1           │\n└───────────────────────────┘                             \n')]
+--------------------+
--Query--
SELECT * FROM read_parquet('__TEST_DIR__/nested_structs.parquet') WHERE s.a.c = true AND s.d.e = 5
--Result--
[({'a': {'b': None, 'c': True}, 'd': {'e': 5, 'f': 'qux'}},)]
+--------------------+
--Query--
EXPLAIN SELECT * FROM read_parquet('__TEST_DIR__/large.parquet') WHERE s.i >= 500 AND s.i < 5000
--Result--
[('physical_plan', '┌───────────────────────────┐\n│       READ_PARQUET        │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│             s             │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│ Filters: s.i>=500 AND s.i │\n│ <5000 AND s.i IS NOT NULL │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│         EC: 20000         │\n└───────────────────────────┘                             \n')]
+--------------------+
--Query--
SELECT min(s.i), max(s.i) FROM read_parquet('__TEST_DIR__/large.parquet') WHERE s.i >= 500 AND s.i < 5000
--Result--
[(500, 4999)]
+--------------------+
