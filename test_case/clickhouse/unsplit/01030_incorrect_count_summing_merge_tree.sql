SET optimize_on_insert = 0;
select '-- SummingMergeTree with Nullable column without duplicates.';
drop table if exists tst;
create table tst (timestamp DateTime, val Nullable(Int8)) engine SummingMergeTree partition by toYYYYMM(timestamp) ORDER by (timestamp);
insert into tst values ('2018-02-01 00:00:00', 1), ('2018-02-02 00:00:00', 2);
select * from tst final order by timestamp;
select '-- 2 2';
select count() from tst;
select '-- 2 2';
select '-- 2 2';
select '-- 2 2 2 2';
select '-- 2 2';
select '-- SummingMergeTree with Nullable column with duplicates';
drop table if exists tst;
create table tst (timestamp DateTime, val Nullable(Int8)) engine SummingMergeTree partition by toYYYYMM(timestamp) ORDER by (timestamp);
insert into tst values ('2018-02-01 00:00:00', 1), ('2018-02-02 00:00:00', 2), ('2018-02-01 00:00:00', 3), ('2018-02-02 00:00:00', 4);
select * from tst final order by timestamp;
select '-- 4 2';
select '-- 4 2';
select '-- 4 2';
select '-- 2 2 2 2';
select '-- 2 2';
select '-- SummingMergeTree without Nullable column without duplicates.';
drop table if exists tst;
create table tst (timestamp DateTime, val Int8) engine SummingMergeTree partition by toYYYYMM(timestamp) ORDER by (timestamp);
insert into tst values ('2018-02-01 00:00:00', 1), ('2018-02-02 00:00:00', 2);
select * from tst final order by timestamp;
select '-- 2 2';
select '-- 2 2 ';
select '-- 2 2';
select '-- 2 2 2 2';
select '-- 2 2';
drop table tst;
select '-- SummingMergeTree without Nullable column with duplicates.';
drop table if exists tst;
create table tst (timestamp DateTime, val Int8) engine SummingMergeTree partition by toYYYYMM(timestamp) ORDER by (timestamp);
insert into tst values ('2018-02-01 00:00:00', 1), ('2018-02-02 00:00:00', 2), ('2018-02-01 00:00:00', 3), ('2018-02-02 00:00:00', 4);
select * from tst final order by timestamp;
select '-- 4 2';
select '-- 4 2';
select '-- 4 2';
select '-- 2 2 2 2';
select '-- 2 2';
drop table tst;
