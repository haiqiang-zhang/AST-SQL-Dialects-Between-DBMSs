--Query--
SYSTEM STOP MERGES t_proj_external
--Result--
[]
+--------------------+
--Query--
SELECT '*** correct aggregation ***'
--Result--
[('*** correct aggregation ***',)]
+--------------------+
--Query--
SELECT k1, k2, k3, sum(value) v FROM t_proj_external GROUP BY k1, k2, k3 ORDER BY k1, k2, k3 SETTINGS optimize_use_projections = 0
--Result--
[(1, 0, 0, 1249950000), (1, 0, 2, 1250000000), (1, 1, 1, 1249975000), (1, 1, 3, 1250025000)]
+--------------------+
--Query--
SELECT '*** correct aggregation with projection ***'
--Result--
[('*** correct aggregation with projection ***',)]
+--------------------+
--Query--
SELECT k1, k2, k3, sum(value) v FROM t_proj_external GROUP BY k1, k2, k3 ORDER BY k1, k2, k3
--Result--
[(1, 0, 0, 1249950000), (1, 0, 2, 1250000000), (1, 1, 1, 1249975000), (1, 1, 3, 1250025000)]
+--------------------+
--Query--
SELECT '*** optimize_aggregation_in_order = 0, max_bytes_before_external_group_by = 1, group_by_two_level_threshold = 1 ***'
--Result--
[('*** optimize_aggregation_in_order = 0, max_bytes_before_external_group_by = 1, group_by_two_level_threshold = 1 ***',)]
+--------------------+
--Query--
SELECT k1, k2, k3, sum(value) v FROM t_proj_external GROUP BY k1, k2, k3 ORDER BY k1, k2, k3 SETTINGS optimize_aggregation_in_order = 0, max_bytes_before_external_group_by = 1, group_by_two_level_threshold = 1
--Result--
[(1, 0, 0, 1249950000), (1, 0, 2, 1250000000), (1, 1, 1, 1249975000), (1, 1, 3, 1250025000)]
+--------------------+
--Query--
SELECT '*** optimize_aggregation_in_order = 1, max_bytes_before_external_group_by = 1, group_by_two_level_threshold = 1 ***'
--Result--
[('*** optimize_aggregation_in_order = 1, max_bytes_before_external_group_by = 1, group_by_two_level_threshold = 1 ***',)]
+--------------------+
--Query--
SELECT k1, k2, k3, sum(value) v FROM t_proj_external GROUP BY k1, k2, k3 ORDER BY k1, k2, k3 SETTINGS optimize_aggregation_in_order = 1, max_bytes_before_external_group_by = 1, group_by_two_level_threshold = 1
--Result--
[(1, 0, 0, 1249950000), (1, 0, 2, 1250000000), (1, 1, 1, 1249975000), (1, 1, 3, 1250025000)]
+--------------------+
--Query--
SYSTEM START MERGES t_proj_external
--Result--
[]
+--------------------+
--Query--
SELECT '*** after materialization ***'
--Result--
[('*** after materialization ***',)]
+--------------------+
--Query--
SELECT '*** correct aggregation ***'
--Result--
[('*** correct aggregation ***',)]
+--------------------+
--Query--
SELECT k1, k2, k3, sum(value) v FROM t_proj_external GROUP BY k1, k2, k3 ORDER BY k1, k2, k3 SETTINGS optimize_use_projections = 0
--Result--
[(1, 0, 0, 1249950000), (1, 0, 2, 1250000000), (1, 1, 1, 1249975000), (1, 1, 3, 1250025000)]
+--------------------+
--Query--
SELECT '*** correct aggregation with projection ***'
--Result--
[('*** correct aggregation with projection ***',)]
+--------------------+
--Query--
SELECT k1, k2, k3, sum(value) v FROM t_proj_external GROUP BY k1, k2, k3 ORDER BY k1, k2, k3
--Result--
[(1, 0, 0, 1249950000), (1, 0, 2, 1250000000), (1, 1, 1, 1249975000), (1, 1, 3, 1250025000)]
+--------------------+
--Query--
SELECT '*** optimize_aggregation_in_order = 0, max_bytes_before_external_group_by = 1, group_by_two_level_threshold = 1 ***'
--Result--
[('*** optimize_aggregation_in_order = 0, max_bytes_before_external_group_by = 1, group_by_two_level_threshold = 1 ***',)]
+--------------------+
--Query--
SELECT k1, k2, k3, sum(value) v FROM t_proj_external GROUP BY k1, k2, k3 ORDER BY k1, k2, k3 SETTINGS optimize_aggregation_in_order = 0, max_bytes_before_external_group_by = 1, group_by_two_level_threshold = 1
--Result--
[(1, 0, 0, 1249950000), (1, 0, 2, 1250000000), (1, 1, 1, 1249975000), (1, 1, 3, 1250025000)]
+--------------------+
--Query--
SELECT '*** optimize_aggregation_in_order = 1, max_bytes_before_external_group_by = 1, group_by_two_level_threshold = 1 ***'
--Result--
[('*** optimize_aggregation_in_order = 1, max_bytes_before_external_group_by = 1, group_by_two_level_threshold = 1 ***',)]
+--------------------+
--Query--
SELECT k1, k2, k3, sum(value) v FROM t_proj_external GROUP BY k1, k2, k3 ORDER BY k1, k2, k3 SETTINGS optimize_aggregation_in_order = 1, max_bytes_before_external_group_by = 1, group_by_two_level_threshold = 1
--Result--
[(1, 0, 0, 1249950000), (1, 0, 2, 1250000000), (1, 1, 1, 1249975000), (1, 1, 3, 1250025000)]
+--------------------+
