--Query--
SELECT DISTINCT * FROM ( SELECT     sum(total_count) AS total,      domain FROM (     SELECT         COUNT(*) AS total_count,          toUInt64(0) AS facebookHits,          domain     FROM transactions      GROUP BY domain     UNION ALL      SELECT         COUNT(*) AS total_count,          SUM(if(domain = 'facebook.com', 1, 0)) AS facebookHits,          domain     FROM clicks      GROUP BY domain )  GROUP BY domain ORDER BY domain LIMIT 10  UNION ALL  SELECT     sum(total_count) AS total,      domain FROM (     SELECT         COUNT(*) AS total_count,          SUM(if(domain = 'facebook.com', 1, 0)) AS facebookHits,          domain     FROM clicks      GROUP BY domain UNION ALL      SELECT         COUNT(*) AS total_count,          toUInt64(0) AS facebookHits,          domain     FROM transactions      GROUP BY domain )  GROUP BY domain ORDER BY domain LIMIT 10 )
--Result--
[(1, 'baidu.com'), (2, 'facebook.com'), (1, 'google.com'), (2, 'meta.ua')]
+--------------------+
--Query--
SELECT DISTINCT total, domain FROM ( SELECT     sum(total_count) AS total,      sum(facebookHits) AS facebook,     domain FROM (     SELECT         COUNT(*) AS total_count,          toUInt64(0) AS facebookHits,          domain     FROM transactions      GROUP BY domain     UNION ALL      SELECT         COUNT(*) AS total_count,          SUM(if(domain = 'facebook.com', 1, 0)) AS facebookHits,          domain     FROM clicks      GROUP BY domain )  GROUP BY domain ORDER BY domain LIMIT 10  UNION ALL  SELECT     sum(total_count) AS total,      max(facebookHits) AS facebook,     domain FROM (     SELECT         COUNT(*) AS total_count,          SUM(if(domain = 'facebook.com', 1, 0)) AS facebookHits,          domain     FROM clicks      GROUP BY domain UNION ALL      SELECT         COUNT(*) AS total_count,          toUInt64(0) AS facebookHits,          domain     FROM transactions      GROUP BY domain )  GROUP BY domain ORDER BY domain LIMIT 10 ) ORDER BY domain, total
--Result--
[(1, 'baidu.com'), (2, 'facebook.com'), (1, 'google.com'), (2, 'meta.ua')]
+--------------------+
--Query--
SELECT * FROM ( SELECT     sum(total_count) AS total,      domain FROM (     SELECT         COUNT(*) AS total_count,          toUInt64(0) AS facebookHits,          domain     FROM transactions      GROUP BY domain     UNION ALL      SELECT         COUNT(*) AS total_count,          SUM(if(domain = 'facebook.com', 1, 0)) AS facebookHits,          domain     FROM clicks      GROUP BY domain )  GROUP BY domain ORDER BY domain LIMIT 10 ) js1 ALL FULL OUTER JOIN ( SELECT     sum(total_count) AS total,      domain FROM (     SELECT         COUNT(*) AS total_count,          SUM(if(domain = 'facebook.com', 1, 0)) AS facebookHits,          domain     FROM clicks      GROUP BY domain UNION ALL      SELECT         COUNT(*) AS total_count,          toUInt64(0) AS facebookHits,          domain     FROM transactions      GROUP BY domain )  GROUP BY domain ORDER BY domain LIMIT 10 ) js2 USING (total, domain) ORDER BY total, domain
--Result--
[(1, 'baidu.com'), (1, 'google.com'), (2, 'facebook.com'), (2, 'meta.ua')]
+--------------------+
--Query--
SELECT total FROM ( SELECT     sum(total_count) AS total,      domain FROM (     SELECT         COUNT(*) AS total_count,          toUInt64(0) AS facebookHits,          domain     FROM transactions      GROUP BY domain     UNION ALL      SELECT         COUNT(*) AS total_count,          SUM(if(domain = 'facebook.com', 1, 0)) AS facebookHits,          domain     FROM clicks      GROUP BY domain )  GROUP BY domain ORDER BY domain LIMIT 10 ) js1 ALL FULL OUTER JOIN ( SELECT     sum(total_count) AS total,      domain FROM (     SELECT         COUNT(*) AS total_count,          SUM(if(domain = 'facebook.com', 1, 0)) AS facebookHits,          domain     FROM clicks      GROUP BY domain UNION ALL      SELECT         COUNT(*) AS total_count,          toUInt64(0) AS facebookHits,          domain     FROM transactions      GROUP BY domain )  GROUP BY domain ORDER BY domain LIMIT 10 ) js2 USING (total, domain) ORDER BY total, domain
--Result--
[(1,), (1,), (2,), (2,)]
+--------------------+
--Query--
SELECT domain FROM ( SELECT     sum(total_count) AS total,      domain FROM (     SELECT         COUNT(*) AS total_count,          toUInt64(0) AS facebookHits,          domain     FROM transactions      GROUP BY domain     UNION ALL      SELECT         COUNT(*) AS total_count,          SUM(if(domain = 'facebook.com', 1, 0)) AS facebookHits,          domain     FROM clicks      GROUP BY domain )  GROUP BY domain ORDER BY domain LIMIT 10 ) js1 ALL FULL OUTER JOIN ( SELECT     sum(total_count) AS total,      domain FROM (     SELECT         COUNT(*) AS total_count,          SUM(if(domain = 'facebook.com', 1, 0)) AS facebookHits,          domain     FROM clicks      GROUP BY domain UNION ALL      SELECT         COUNT(*) AS total_count,          toUInt64(0) AS facebookHits,          domain     FROM transactions      GROUP BY domain )  GROUP BY domain ORDER BY domain LIMIT 10 ) js2 USING (total, domain) ORDER BY total, domain
--Result--
[('baidu.com',), ('google.com',), ('facebook.com',), ('meta.ua',)]
+--------------------+
